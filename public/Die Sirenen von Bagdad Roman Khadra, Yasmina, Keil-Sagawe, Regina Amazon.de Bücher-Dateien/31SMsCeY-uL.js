'use strict';mix_d("CerberusSharedCards__cerberus-shared:cerberus-shared__yd4Qi_78","require exports tslib @p/A @c/metrics @c/aui-utils @c/pagemarker @c/aui-truncate @c/logger @c/remote-operations @c/tracking @c/scoped-dom @c/aui-feature-detect".split(" "),function(J,K,m,R,B,S,T,U,C,V,D,W,X){function x(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}function L(a){if(a&&a.__esModule)return a;var f=Object.create(null);a&&Object.keys(a).forEach(function(b){if("default"!==b){var c=Object.getOwnPropertyDescriptor(a,
b);Object.defineProperty(f,b,c.get?c:{enumerable:!0,get:function(){return a[b]}})}});f["default"]=a;return f}var v=x(R),l=x(B),Y=x(S),Z=x(T),aa=x(U),ba=x(V),w=x(W),ca=x(X),M={},E=function(a,f,b){void 0===f&&(f="");void 0===b&&(b=1);f=a+f;M.hasOwnProperty(f)||(M[f]=!0,B.count(a,(B.count(a)||0)+b))},da=function(a){E(v["default"].capabilities.mobile?"Card:EERU:SharedLib:mobile:render":"Card:EERU:SharedLib:desktop:render");var f=function(c,d){c={$event:{preventDefault:v["default"].$.noop,stopPropagation:v["default"].$.noop},
$target:c.getContent().find('[data-a-tab-name="'+d+'"]'),data:{name:"energyEfficiencyTabSet"}};v["default"].trigger("a:declarative:a-tabs:click",c)},b=function(c,d){var e=c&&c.$event,h=c&&c.data||{},n=h.activeTabName,g=h.modalHeight,r=h.name;e&&e.preventDefault&&e.preventDefault();e&&e.stopPropagation&&e.stopPropagation();e=d.get(r);e||(v["default"].on("a:popover:beforeShow:"+r,function(p){p.popover&&p.popover.getContent&&(p=p.popover.getContent(),p.find(".a-manually-loaded").parent().css("min-height",
g),v["default"].loadDescendantImagesManually(p))}),e=d.create(c.$target,h));e.show();f(e,n)};a.when("a-secondary-view").execute("RegisterEnergyEfficiencyEventMobile",function(c){v["default"].declarative("card-energy-efficiency-secondary-view","click",function(d){E("Card:EERU:SharedLib:mobile:click",d&&d.data&&d.data.name||"");b(d,c)})});a.when("a-modal").execute("RegisterEnergyEfficiencyEventDesktop",function(c){v["default"].declarative("card-energy-efficiency-modal","click",function(d){E("Card:EERU:SharedLib:desktop:click",
d&&d.data&&d.data.name||"");b(d,c)})})},ea=function(a){a.when("ready").execute("EEBadgeProductFicheResize",function(f){var b=v["default"].$;b(".energyEfficiencyContainer").each(function(c,d){c=b(d).find(".energyEfficiencyProductFicheLabel").first();d=b(d).find("svg").first();c.parent().outerHeight()>d.outerHeight()&&(c.removeClass("a-size-small"),c.addClass("a-size-micro"),c.parent().outerHeight()>d.outerHeight()&&c.parent().css("line-height","10px"))})})},fa=function(){var a=window.P;da(a);ea(a)},
y={wb:1},ha=function(a,f,b){if(a){for(var c=[],d=0;d<a.length;d++){var e=a[d],h=f[d],n=b[d],g={};e.dataset.subasin&&(g.subsAsin=e.dataset.subasin);e.dataset.subasinprice&&"true"!==h.dataset.isparent&&(g.subsPrice=parseFloat(e.dataset.subasinprice),g.subsIsParent=!1);e.dataset.subasincurrency&&(g.subsCurrency=e.dataset.subasincurrency);e.dataset.subasinrating&&(g.subsAvgRating=parseFloat(e.dataset.subasinrating));e.dataset.subasintotalreviews&&(g.subsTotalReviews=parseInt(e.dataset.subasintotalreviews.replace(/[.,\s]/g,
""),10));e.dataset.subasinsourcesmap&&(g.subsSourcesMap=e.dataset.subasinsourcesmap);h.dataset&&h.dataset.lowestprice&&h.dataset.highestprice&&(g.subsPrice=parseFloat(h.dataset.lowestprice),g.subsLowestPrice=parseFloat(h.dataset.lowestprice),g.subsHighestPrice=parseFloat(h.dataset.highestprice),g.subsIsParent=!0);g.subsPrimeEligible=n.dataset.isprime&&"true"===n.dataset.isprime?!0:!1;g.subsPosition=d;g.subsSource=null;g.subsSourceScore=null;c.push(g)}return c}},ia=function(a,f){return m.__awaiter(void 0,
void 0,void 0,function(){var b,c;return m.__generator(this,function(d){switch(d.label){case 0:return ca["default"].isSupported("isAmazonApp")?[4,new Promise(function(e,h){J(["@m/mash"],function(n){e(L(n))},h)})]:[3,2];case 1:return b=d.sent(),b.cart.didUpdate({newCartQuantity:a}),[3,4];case 2:return[4,new Promise(function(e,h){J(["@p/nav.setCartCount"],function(n){e(L(n))},h)})];case 3:c=d.sent(),c.default(a),d.label=4;case 4:return[2]}})})},F=function(a,f,b,c){"undefined"===typeof c?(a.style.display=
"block",f.style.display="none",b.style.display="none"):c?(a.style.display="none",f.style.display="block",b.style.display="none"):(a.style.display="none",f.style.display="none",b.style.display="block")},ja=function(a){a=a?a.dataset:{};return{deviceType:a.deviceType,seedAsin:a.landedAsin,subsReason:a.displayReason}},G=function(a,f){var b=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_asinTitle__1nn_H"),c=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_asinPriceRange__yoi8E"),
d=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_primeBadge__2RNdQ"),e=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_asinImage__3JG_P"),h=a.dataset.customerId||null,n=a.dataset.marketplaceId,g=a.dataset.sessionId,r=a.dataset.requestId,p=ja(a),z=ha(b,c,d);c=function(k){var q=b[k],t={subsAsin:(q?q.dataset:{}).subasin};k=m.__assign(m.__assign({customerId:h,obfuscatedMarketplaceId:n,sessionId:g},p),null===z||void 0===z?void 0:z[k]);l["default"].event(k,f,"prservices.SurfacedSubstituteEvent.6");
var A=m.__assign(m.__assign({obfuscatedMarketplaceId:n,sessionId:g,surfacedAsinRequestId:r},p),t);q.onclick=function(){return m.__awaiter(void 0,void 0,void 0,function(){return m.__generator(this,function(N){l["default"].event(A,f,"prservices.ClickedSubstituteEvent.3");return[2]})})}};for(a=0;a<b.length;a++)c(a);c=function(k){k=e[k];var q={subsAsin:(k?k.dataset:{}).subasin},t=m.__assign(m.__assign({obfuscatedMarketplaceId:n,sessionId:g,surfacedAsinRequestId:r},p),q);k.onclick=function(){return m.__awaiter(void 0,
void 0,void 0,function(){return m.__generator(this,function(A){l["default"].event(t,f,"prservices.ClickedSubstituteEvent.3");return[2]})})}};for(a=0;a<e.length;a++)c(a)},ka=function(a,f,b,c){return m.__awaiter(void 0,void 0,void 0,function(){var d,e,h;return m.__generator(this,function(n){d=a.dataset.reftag||"";e=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_actions_action__2rnkD");if(!(e&&0<e.length))return[2];h="prservices_cart_percolate"===f?"rsi.cart.":"rsi.oos.";l["default"].count(h+
"atc.shown."+b,1);Array.prototype.forEach.call(e,function(g,r){var p=d+"_oos_atcajx_"+b+"_"+r,z=d+"_oos_cartajx_"+b+"_"+r;r=g.querySelector("button");var k=g.querySelector("._cerberus-shared_actions_action-message-loading___LqSL"),q=g.querySelector("._cerberus-shared_actions_action-message-success__3NeI4"),t=g.querySelector("._cerberus-shared_actions_action-message-fail__1S0wg");g=r?r.dataset:{};var A=g.asin,N=g.offerlistingid;r.addEventListener("click",function(la){return m.__awaiter(void 0,void 0,
void 0,function(){var O,P,H,Q,I;return m.__generator(this,function(u){switch(u.label){case 0:l["default"].count(h+"atc.click."+b,1),F(k,q,t,void 0),u.label=1;case 1:return u.trys.push([1,3,,4]),O={asin:A,offerListingId:N},[4,D.addTracking(c.addToCart,{},p||"")(O)];case 2:return u.sent(),[3,4];case 3:return P=u.sent(),C.log("CerberusSharedCards.ATC."+P.toString(),"ERROR"),l["default"].count(h+"atc.fail."+b,1),F(k,q,t,!1),[2];case 4:l["default"].count(h+"atc.success."+b,1),H=null,u.label=5;case 5:return u.trys.push([5,
7,,8]),[4,D.addTracking(c.getCartCount,{},z||"")()];case 6:return H=u.sent(),[3,8];case 7:return Q=u.sent(),C.log("CerberusSharedCards.getCartCount."+Q.toString(),"ERROR"),l["default"].count(h+"gcc.fail."+b,1),[2];case 8:return l["default"].count(h+"gcc.success."+b,1),F(k,q,t,!0),[4,ia(H.items)];case 9:return u.sent(),I=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_addToCartClickedFlag__3rAXC"),0<I.length&&I[0].setAttribute("value","true"),[2]}})})})});return[2]})})};K._operationNames=
["addToCart","getCartCount","getPrimeBadge"];K.card=function(){return m.__awaiter(void 0,void 0,void 0,function(){var a,f,b,c,d,e,h,n,g,r,p;return m.__generator(this,function(z){l["default"].uet("bb","cerberus-shared",y);a=ba["default"].setup();f=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_landingPageData__26puO")[0];b=f.dataset.producerId;c=f.dataset.deviceType||"";d=f.dataset.reftag||"";e=f.dataset.refreshImages||"";"prservices_dpx_percolate"===b?l["default"].count("prservices.ooswidget.shown."+
c,1):"prservices_fod_widget_feedback_loop"===b?l["default"].count("prservices.fodwidget.shown."+c,1):"prservices_cart_percolate"===b&&aa["default"].refreshAutoTruncate();h=[];n=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_lazyPrimeBadge__1Jj-2");Array.prototype.forEach.call(n,function(k){k.dataset.asin&&h.push(k.dataset.asin)});ka(f,b,c,a);l["default"].uet("cf","cerberus-shared",y);("prservices_fod_widget_feedback_loop"===b||"pd_lpo"===d||"pd_lpo_sa"===d||"prservices_dpx_percolate"===
b)&&0<h.length?D.addTracking(a.getPrimeBadge)(h).then(function(k){Array.prototype.forEach.call(n,function(q){var t=q.dataset.asin;t&&k[t]?(q.classList.remove("_cerberus-shared_style_hidden__V3R2s"),q.dataset.isprime="true"):(q.classList.add("_cerberus-shared_style_hidden__V3R2s"),q.dataset.isprime="false")});l["default"].uet("be","cerberus-shared",y);b&&G(f,b);l["default"].uex("ld","cerberus-shared",y)}).catch(function(k){C.log("getPrimeBadge failed: "+k);l["default"].uet("be","cerberus-shared",y);
b&&G(f,b);l["default"].uex("ld","cerberus-shared",y)}):(l["default"].uet("be","cerberus-shared",y),b&&G(f,b),l["default"].uex("ld","cerberus-shared",y));if("T1"===e)for(g=w["default"].cardRoot.getElementsByClassName("_cerberus-shared_style_asinImage__3JG_P"),r=function(k){var q=g[k].getElementsByTagName("img")[0];Z["default"].pageLoad.then(function(){return Y["default"].loadDynamicImage(q)})},p=0;p<g.length;p++)r(p);fa();return[2]})})}});
