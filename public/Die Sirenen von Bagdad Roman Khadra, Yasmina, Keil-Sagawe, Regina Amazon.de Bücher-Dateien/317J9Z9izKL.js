'use strict';mix_d("MorpheusPopularityRankSidesheetCards__morpheus-popularity-rank-sidesheet-card:morpheus-popularity-rank-sidesheet-card__x955Phvo","exports tslib @c/browser-operations @c/logger @c/metrics @c/scoped-dom @p/monarch-sidesheet @c/remote-operations".split(" "),function(E,z,M,N,m,O,P,Q){function t(b){return b&&"object"===typeof b&&"default"in b?b:{"default":b}}var R=t(M),y=t(N),p=t(O),q=t(P),F=t(Q),A;(function(b){b.asinItemClickMetricReportHandler="asinItemClickMetricReportHandler";b.aodLinkClickHandler=
"aodLinkClickHandler"})(A||(A={}));var G=A,B=function(b){var a=0,e=setInterval(function(){5<a&&clearInterval(e);a++;var d=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_header__1CUj_")[0],f=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0];if(d||f)clearInterval(e),b.focus()},500)},H=function(b){var a=0,e=setInterval(function(){5<a&&clearInterval(e);a++;var d=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_item_link__1pKM-")[0];
d&&(clearInterval(e),d.focus())},500)},I=function(b){var a=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_err-view__V9B13")[0];b&&a&&(b.innerHTML=a.innerHTML)},r=function(b){b&&(b.style.display="none")},u=function(b,a){return a?b+"T1":b+"C"},J=new Map([["kindle_meta_binding","Kin"],["audiobooks_digital_meta_binding","Aud"],["hardcover_meta_binding","Hrd"],["paperback_meta_binding","Pap"],["mass_market_paperback_meta_binding","Mmp"],["audiobooks_meta_binding",
"Abk"]]),K=function(b){return J.has(b)?"morpheusSidesheetTabClicked"+J.get(b):"morpheusSidesheetTabClickedOther"},v,w=function(){var b;return 0<(null===(b=p["default"].cardRoot.getElementsByClassName("isPopularityWeblabEnabled"))||void 0===b?void 0:b.length)},V=function(b){b.preventDefault();var a=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0],e=p["default"].cardRoot.getElementsByClassName("landingAsinValue")[0];if(a&&e&&e.value){b=
p["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];!v&&b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0]&&q["default"].setContent("");var d=Date.now();m.count("seeAllFormatsExpanderClicked",1);m.count(u("seeAllFormatsExpanderClicked",w()),1);q["default"].show();if(v)B(a);else{var f=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_content-ctr__jbXAx")[0],l=function(){q["default"].setContent(f.innerHTML);
S(a);T(a);var k=R["default"].setup().define;k(G.asinItemClickMetricReportHandler,"click",function(c){var h,n,x,C;c=c.target.parentElement;var U="true"===(null===(h=null===c||void 0===c?void 0:c.dataset)||void 0===h?void 0:h.newRelease);h="true"===(null===(n=null===c||void 0===c?void 0:c.dataset)||void 0===n?void 0:n.popularityEnabled);U&&m.count(h?"morpheusNewReleasedItemClickedWithBadge":"morpheusNewReleasedItemClickedNoBadge",1);m.count("morpheusEditionItemClicked",1);m.count(u("morpheusEditionItemClicked",
w()),1);n="true"===(null===(x=null===c||void 0===c?void 0:c.dataset)||void 0===x?void 0:x.isPopular);x="true"===(null===(C=null===c||void 0===c?void 0:c.dataset)||void 0===C?void 0:C.isPopularBadgeWeblabEnabled);n&&h&&m.count(x?"morpheusPopularItemClickedWithBadge":"morpheusPopularItemClickedNoBadge",1)});k(G.aodLinkClickHandler,"click",function(c){var h;c=c.target;c.classList.contains("morpheusAodEntryLink")&&!c.classList.contains("morpheusAodDeclarativeAction")&&(q["default"].closeSidesheet(c.id),
c=null===(h=c.parentElement)||void 0===h?void 0:h.getElementsByClassName("morpheusAodDeclarativeAction")[0])&&(c.click(),m.count("morpheusAODClicked",1),m.count(u("morpheusAODClicked",w()),1))});k=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR");for(var g=0;g<k.length;g++)k[g].getElementsByClassName("sidesheetAsinListContainer")[0]&&L(e.value,k[g]);k=Date.now()-d;m.count("morpheusSidesheetContentLoadLatency",k);v=!0};F["default"].setup().getSidesheetHtml({asin:e.value}).then(function(k){f&&
(f.innerHTML=k.outerHTML,l(),B(a))}).catch(function(k){I(f);q["default"].setContent(f.innerHTML);v=!1;m.count("failedRenderSidesheetContent",1);B(a);y["default"].log("Experiencing some issues to load sidesheet view for ASIN "+e.value+", trace: "+k,"ERROR")})}}else y["default"].log("Not able to open see all formats sidesheet, missing neccessary component.","FATAL")},D=function(b,a,e,d){var f=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content-spinner__3lJtW")[0],l=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0],
k=b.getElementsByClassName("sidesheetAsinListContainer")[0];r(k);r(l);f&&(f.style.display="inline-block");F["default"].setup().getMetabindingTabContentHtml({asin:a,totalPageNumber:e,currentPageNumber:d?d:1}).then(function(g){b.innerHTML=g.innerHTML;L(a,b,e);H(b)}).catch(function(g){I(b);r(f);b.innerHTML+=f.outerHTML;m.count("failedRenderMetabindingTabContent",1);y["default"].log("Experiencing some issues to load tab content view, trace: "+g,"ERROR")})},S=function(b){var a=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z"),
e=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR"),d=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];d=null===d||void 0===d?void 0:d.getElementsByClassName("metabindingSymbol")[0];"audiobooks_digital_meta_binding"===(null===d||void 0===d?void 0:d.value)&&(m.count("seeAllFormatsExpanderClickedAud",1),b.getElementsByClassName("isLoggedInCustomer")[0]&&m.count("seeAllFormatsExpanderClickedAudLoggedIn",1));d=function(l){var k=
e[l].getElementsByClassName("a-box-inner")[0];k&&(k.style.padding="0");a[l].addEventListener("click",function(){var g=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];if(g!==a[l]){var c=a[l].getElementsByClassName("metabindingSymbol")[0];c&&c.value&&(m.count(K(c.value),1),m.count(u(K(c.value),w()),1),"audiobooks_digital_meta_binding"===c.value&&b.getElementsByClassName("isLoggedInCustomer")[0]&&m.count("morpheusSidesheetTabClickedAudLoggedIn",1));a[l].className=
"_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z _morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd";g.className="_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z";g=e[l];if((c=g.getElementsByClassName("sidesheetAsinListContainer")[0])&&"none"!==c.style.display)H(g);else{c=a[l].getElementsByClassName("winningAsin")[0];var h=a[l].getElementsByClassName("totalPages")[0];D(g,c.value,Number(h.value))}}})};for(var f=0;f<a.length;f++)d(f)},T=function(b){var a=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-row__1Uxai")[0],
e=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back__2cqlo")[0],d=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw__2NDFi")[0];if(e&&d&&a){var f=e.offsetLeft>d.offsetLeft;f&&(e.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back-radius__2TGra"),d.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw-radius__3O1Mg"));var l=!1,k=f&&3<a.scrollLeft,g;r(e);var c=function(){return k?3>=Math.abs(a.scrollLeft):
3>=a.scrollWidth-Math.abs(a.scrollLeft)-a.offsetWidth},h=function(){return k?3>=a.scrollWidth-Math.abs(a.scrollLeft)-a.offsetWidth:3>=Math.abs(a.scrollLeft)};c()&&r(d);a.addEventListener("scroll",function(){c()&&"none"!==d.style.display?(r(d),clearInterval(g)):!c()&&"none"===d.style.display&&d&&(d.style.display="inline-block");h()&&"none"!==e.style.display?(r(e),clearInterval(g)):!h()&&"none"===e.style.display&&e&&(e.style.display="inline-block")});d.addEventListener("mousedown",function(){g=setInterval(function(){var n=
a.scrollLeft;f&&!l?a.scrollLeft-=3:a.scrollLeft+=3;f&&!l&&0===n&&0===a.scrollLeft&&(l=!0,a.scrollLeft+=3)},10)});d.addEventListener("mouseup",function(){clearInterval(g)});e.addEventListener("mousedown",function(){g=setInterval(function(){f&&!l?a.scrollLeft+=3:a.scrollLeft-=3},10)});e.addEventListener("mouseup",function(){clearInterval(g)})}},L=function(b,a,e){for(var d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_pagination__4GE1X")[0],f=a.getElementsByClassName("a-pagination")[0].getElementsByTagName("li"),
l=function(g){var c=f[g];c.classList.contains("a-disabled")||c.addEventListener("click",function(h){h.preventDefault();h=c&&c.classList.contains("a-selected");var n;0===g&&d.dataset.prevPageNumber?n=Number(d.dataset.prevPageNumber):g===f.length-1&&d.dataset.nextPageNumber?n=Number(d.dataset.nextPageNumber):c&&c.dataset.pageNumber&&(n=Number(c.dataset.pageNumber));c&&!h&&n&&(m.count("morpheusSidesheetOtherPageNavigated",1),m.count(u("morpheusSidesheetOtherPageNavigated",w()),1),e?D(a,b,e,n):(h=f[f.length-
2])&&h.dataset.pageNumber&&D(a,b,Number(h.dataset.pageNumber),n))})},k=0;k<f.length;k++)l(k)};E._operationNames=["getSidesheetHtml","getMetabindingTabContentHtml"];E.card=function(){return z.__awaiter(void 0,void 0,void 0,function(){var b,a,e,d,f,l,k,g;return z.__generator(this,function(c){b=p["default"].cardRoot.getElementsByClassName("morpheusRoot")[0];if(!b)return[2];a=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_saf-link__2TS-U")[0];e=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0];
d=p["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];f=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_overlay__T88OB")[0];l=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_spinner__VHgKZ")[0];k=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet-close__13oI1")[0];g=[e,d,f,l,k];if(g.every(function(h){return h})&&g.map(function(h){return h.id}).every(function(h){return h}))q["default"].initialize.apply(q["default"],
z.__spread(g.map(function(h){return h.id}))),k.tabIndex=0;else return y["default"].log("Not able to initialize see all formats sidesheet, missing neccessary component or component id.","FATAL"),[2];v=!1;a&&a.addEventListener("click",V);return[2]})})}});
